name: Check for Star

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

jobs:
  check-star:
    runs-on: ubuntu-latest
    steps:
      - name: Check if user starred the repo
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const username = context.payload.sender.login;
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
            if (username === owner) return;

            // GraphQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ 100 Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ·Ğ²Ñ‘Ğ·Ğ´
            const query = `
              query($owner: String!, $repo: String!) {
                repository(owner: $owner, name: $repo) {
                  stargazers(first: 100, orderBy: {field: STARRED_AT, direction: DESC}) {
                    nodes {
                      login
                    }
                  }
                }
              }
            `;

            const result = await github.graphql(query, { owner, repo });

            const hasStarred = result.repository.stargazers.nodes.some(
              user => user.login.toLowerCase() === username.toLowerCase()
            );

            if (!hasStarred) {
              const issue_number = context.payload.issue?.number
                || context.payload.comment?.issue_url.split('/').pop();

              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number,
                body: `ğŸ‘‹ Hey @${username}, glad you're using **${repo}**!
                      If the library has helped you â€” consider supporting the project with a â­ on GitHub. It helps with visibility and further development!

                      ğŸ‘‰ https://github.com/${owner}/${repo}`
            });
            } else {
            console.log(`${username} has already starred the repo.`);
            }
